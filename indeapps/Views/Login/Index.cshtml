@{
    ViewData["Title"] = "Login";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Indeapps</title>
    <link rel="stylesheet" href="~/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="~/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="~/css/style.css">
    <link rel="shortcut icon" href="~/images/favicon.png" />
</head>
<body>
    <div class="container-scroller">
        <div class="container-fluid page-body-wrapper full-page-wrapper">
            <div class="row w-100 m-0">
                <div class="content-wrapper full-page-wrapper d-flex align-items-center auth login-bg">
                    <div class="card col-lg-4 mx-auto">
                        <div class="card-body px-5 py-5">
                            <h3 class="card-title text-left mb-3">Login</h3>
                            <form>
                                <div class="form-group">
                                    <label>NIK</label>
                                    <input type="text" class="form-control p_input">
                                </div>
                                <div class="form-group">
                                    <label>Password *</label>
                                    <input type="text" class="form-control p_input">
                                </div>
                                <div class="form-group d-flex align-items-center justify-content-between">
                                    <div class="form-check">
                                        <label class="form-check-label">
                                            <input type="checkbox" class="form-check-input"> Remember me
                                        </label>
                                    </div>
                                    <a href="#" class="forgot-pass">Forgot password</a>
                                </div>
                                <div class="form-group">
                                    <select class="form-control form-control-md" id="kategori_user_id" name="kategori_user_id" onchange="pilihKategoriUser()" disabled>
                                        <option value="">- Pilih kategori user -</option>
                                    </select>
                                </div>
                                <button id="login" type="button" onclick="btnLogin()" class="btn btn-user btn-block" style="background-color:@ViewBag.Setting.theme;color: #fff;">
                                    Login
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="~/vendors/js/vendor.bundle.base.js"></script>
    <script src="~/js/off-canvas.js"></script>
    <script src="~/js/hoverable-collapse.js"></script>
    <script src="~/js/misc.js"></script>
    <script src="~/js/settings.js"></script>
    <script src="~/js/todolist.js"></script>
    @section scripts {
        <script src="~/jquery-3.6.0.min.js"></script>
        <script src="~/jquery-3.6.0.js"></script>
        <script>
            var link = '@Url.Action("Function", "Controller")'
            var controller_name = "@ViewBag.Controller"
            var a
            var dataTable


            $('.form-control-user').keypress(function (e) {
                if (e.which == 13) {
                    btnLogin()
                    return false;
                }
            });

            function getCredentials() {
                //GetIP
                window.RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;//compatibility for Firefox and chrome
                var pc = new RTCPeerConnection({ iceServers: [] }), noop = function () { };
                pc.createDataChannel('');//bogus data channel
                pc.createOffer(pc.setLocalDescription.bind(pc), noop);// create offer and set local description
                pc.onicecandidate = function (ice) {
                    if (ice && ice.candidate && ice.candidate.candidate) {
                        var myIP = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate)[1]
                        $('#ip').val(myIP)
                        pc.onicecandidate = noop
                    }
                }
            }

            function btnLogin() {
                $('#login').text('Loading...')
                $('#login').prop('disabled', true)
                var urlTo = '@Url.Action("Index", "Dashboard")'
                var options = $("#kategori_user_id");

                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("ProsesLogin", "Login")',
                    data: $('#formBS').serialize(),
                    success: function (data) {
                        if (data.status == true) {
                            $('#login').text('Pilih kategori user')
                            $('#kategori_user_id').prop('disabled', false)
                            for (a = 0; a < data.data.length; a++) {
                                options.append($("<option />").val(data.data[a].kategori_user_id).text(data.data[a].kategori_user_id));
                            }
                        } else {
                            $('#login').text('Login')
                            $('#login').prop('disabled', false)
                            alert('Invalid username or password')
                        }
                    },
                    error: function (error) {
                        $('#login').text('Login')
                        $('#login').prop('disabled', false)
                        alert('Invalid username or password')
                    }
                })
            }

            function pilihKategoriUser() {
                var kategori_user_id = $("#kategori_user_id").val()
                $('#login').text('Loading...')

                $.ajax({
                    type: "GET",
                    url: '@Url.Action("CekKategoriUser", "Login")?kategori_user_id=' + kategori_user_id,
                    success: function (data) {
                        var link = '@Url.Action("Function", "Controller")';
                        link = link.replace("Controller", data.data.login_controller);
                        link = link.replace("Function", data.data.login_function);
                        if (data.status) {
                            location.href = link
                        } else {
                            alert(data.data)
                        }
                    }
                })
            }

        </script>
    }
</body>
</html>